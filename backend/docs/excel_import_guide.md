# Excel文件导入最佳实践指南

## 概述

本系统支持通过Excel文件批量导入学生信息和分组信息，并提供分阶段填写机制，让学生可以后续补充详细信息。

## 最佳实践流程

### 第一阶段：管理员导入基础信息

1. **下载导入模板**
   ```
   GET /api/students/download_template/  # 下载学生信息模板
   GET /api/groups/download_template/    # 下载分组信息模板
   ```

2. **准备Excel文件**
   - 学生信息文件包含：姓名、身份证号、手机号码（可选）、邮箱（可选）
   - 分组信息文件包含：通知书编号、所属分组、分组教师、教师联系方式、报到地点

3. **批量导入数据**
   ```
   POST /api/students/import_excel/  # 上传学生信息文件
   POST /api/groups/import_excel/    # 上传分组信息文件
   ```

### 第二阶段：学生自行补充信息

学生可以通过以下API补充详细信息：

```
POST /api/students/{id}/complete_profile/
```

**可补充的字段：**
- `residence_status`: 住校情况（住校/不住校）
- `height`: 身高（cm）
- `weight`: 体重（kg）
- `uniform_purchase`: 是否订购校服（true/false）
- `interests_talents`: 兴趣特长描述
- `phone_number`: 手机号码
- `email`: 邮箱地址

### 第三阶段：管理员分配分组

```
POST /api/groups/{group_id}/assign_student/
{
    "student_id": 1,
    "remarks": "优秀学生"
}
```

## 数据状态管理

### 学生信息完整度状态

- **IMPORTED**: 已导入（仅有基础信息）
- **PARTIAL**: 部分完成（补充了部分详细信息）
- **COMPLETE**: 信息完整（所有必填信息已完善）

### 监控信息完成情况

```
GET /api/students/statistics/           # 获取整体统计
GET /api/students/incomplete_profiles/  # 获取未完善资料的学生列表
```

## Excel文件格式要求

### 学生信息文件格式

| 姓名 | 身份证号 | 手机号码 | 邮箱 |
|------|----------|----------|------|
| 张三 | 110101200001011234 | 13800138001 | zhangsan@example.com |
| 李四 | 110101200002022345 | | |

**字段说明：**
- 姓名：必填，学生真实姓名
- 身份证号：必填，18位身份证号码，用于自动计算性别和年龄
- 手机号码：可选，11位手机号码
- 邮箱：可选，有效的邮箱地址

### 分组信息文件格式

| 通知书编号 | 所属分组 | 分组教师 | 教师联系方式 | 报到地点 |
|------------|----------|----------|--------------|----------|
| A001 | 计算机科学A组 | 陈老师 | 13800138001 | 教学楼A201 |
| B001 | 数学与应用数学B组 | 刘老师 | 13800138002 | 教学楼B301 |

**字段说明：**
- 通知书编号：必填，唯一标识符
- 所属分组：必填，分组名称
- 分组教师：必填，负责教师姓名
- 教师联系方式：必填，11位手机号码
- 报到地点：必填，学生报到地点

## 错误处理和数据验证

### 导入时的验证规则

1. **身份证号验证**
   - 必须为18位
   - 前17位必须为数字
   - 最后一位为数字或X
   - 系统内唯一（不允许重复）

2. **手机号验证**
   - 11位数字
   - 以1开头，第二位为3-9

3. **数据去重**
   - 身份证号重复的记录会被跳过
   - 通知书编号重复的记录会被跳过

### 导入结果示例

```json
{
    "success": true,
    "batch_name": "batch_20250630_211400",
    "success_count": 2,
    "skip_count": 1,
    "errors": [],
    "warnings": [
        "第3行: 身份证号 110101200001011234 已存在，跳过"
    ]
}
```

## 学生自助完善流程设计

### 1. 学生登录验证
建议通过身份证号码作为学生的唯一标识进行验证。

### 2. 信息完善界面
- 显示已有的基础信息（只读）
- 提供表单让学生填写详细信息
- 实时显示完成进度百分比

### 3. 分步骤填写
```javascript
// 前端可以分步骤引导学生填写
const steps = [
    { title: '住宿信息', fields: ['residence_status'] },
    { title: '体征信息', fields: ['height', 'weight'] },
    { title: '校服订购', fields: ['uniform_purchase'] },
    { title: '兴趣特长', fields: ['interests_talents'] },
    { title: '联系方式', fields: ['phone_number', 'email'] }
];
```

### 4. 数据验证反馈
系统会实时验证输入数据并提供友好的错误提示。

## 批量操作最佳实践

### 1. 分批导入
对于大量数据，建议分批次导入：
- 每批500-1000条记录
- 使用有意义的批次名称便于管理

### 2. 数据备份
导入前建议备份现有数据：
```bash
python manage.py dumpdata core groups > backup_before_import.json
```

### 3. 错误处理
- 导入失败的记录会回滚，不会影响已成功的记录
- 详细的错误日志帮助定位问题
- 支持修正后重新导入

## 监控和统计

### 获取导入批次统计
```
GET /api/students/statistics/
```

### 查看特定批次的学生
```
GET /api/students/?import_batch=batch_20250630_211400
```

### 监控信息完善进度
```
GET /api/students/?info_status=IMPORTED     # 仅导入的学生
GET /api/students/?info_status=PARTIAL      # 部分完成的学生
GET /api/students/?info_status=COMPLETE     # 信息完整的学生
```

## 前端集成建议

### 1. 文件上传组件
使用Ant Design的Upload组件，支持拖拽上传和进度显示。

### 2. 数据表格展示
使用Table组件展示导入结果，支持筛选和排序。

### 3. 进度指示器
使用Progress组件显示学生信息完善进度。

### 4. 表单验证
实时验证用户输入，提供友好的错误提示。

这套方案提供了完整的数据导入和分阶段填写流程，既满足了管理员批量导入的需求，又为学生提供了灵活的信息补充机制。
